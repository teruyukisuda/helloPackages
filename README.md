# branch構成

* develop(最新の開発ブランチ)
* feature-xxx(各開発ブランチ)
* 0.x.x(0.1.xや0.2.xなど バグフィックス用のリリースブランチ)
    * 0.1.x(0.1系のリリースブランチ)
    * 0.2.x(0.2系のリリースブランチ)

# 開発方法

### 新機能開発

* ブランチ作成
    * developからfeatureブランチを作成
* 開発完了
    * developに対してPR作成
    * PR作成時に自動テスト実行
    * レビュー後merge

### bugfix開発(リリースブランチごととdevelopに対して同じことをする)(競合が多い場合)

* ブランチ作成
    * リリースブランチ（0.1.xなど）からfeatureブランチ作成
* 開発完了
    * リリースブランチに対してPR作成
    * PR作成時に自動テスト実行
    * レビュー後リリースブランチにmerge
    * developブランチに対しても別PRを作成し、レビュー後developブランチにもmerge(
      ここではdevelopブランチからfeatureを作成しておく)

### bugfixはcherry-pickするケース(競合が少ない場合)

* ブランチ作成
    * 最も古いバージョンのリリースブランチからfeatureブランチ作成
* 開発完了
    * 対象のリリースブランチに対してPR作成
    * PR作成時に自動テスト実行
    * レビュー後対象のリリースブランチにmerge
    * そのマージコミットではなく、featureブランチの修正コミットを他のリリースブランチとdevelopにcherry-pickする
    ```
    マージコミットをチェリーピックするよりも、
    実際のバグ修正を含む個別のコミット（featureブランチ上の修正コミット）
    をチェリーピックする

    マージコミットにはマージ自体の情報が含まれており、
    純粋な修正コードだけでなく余分な情報も含まれいる

    個別の修正コミットの方が変更内容が明確で、
    チェリーピック時の競合も把握しやすい
    複数の修正がある場合、必要な修正だけを選択的にチェリーピック

    修正内容が複数のコミットに分かれている場合は、
    それらをまとめてチェリーピックするか、
    もしくはsquashコミットを作成してからチェリーピックする
    ```

# バージョニングと開発プロセス

このプロジェクトでは、開発中は常にSNAPSHOTバージョンを使用しています。例えば、`0.1.9-SNAPSHOT`のように、バージョン番号に`-SNAPSHOT`サフィックスが付いています。

## SNAPSHOTバージョンについて

* 開発中は常にSNAPSHOTバージョンを使用します
* SNAPSHOTバージョンは不安定な開発中のバージョンを示します
* リリース時にのみSNAPSHOTサフィックスが削除されます

## リリースプロセス

リリースは`.github/workflows/release.yml`で定義されたGitHub Actionsワークフローを使用して行われます。このプロセスでは以下のことが行われます：

1. リリースバージョンの指定（手動トリガー）
2. SNAPSHOTサフィックスの削除
3. ビルドとテスト
4. GitHubパッケージへのデプロイ

リリースプロセスの詳細については、`.github/workflows/release.yml`ファイルを参照してください。

### リリースステータス

最新のリリース（v0.1.9）は正常に完了しました。リリースプロセスが更新され、今後のリリースでは以下のアセットのみが生成されます：

- hello-packages-{バージョン}-sources.jar
- hello-packages-{バージョン}.jar

※javadoc.jar、zip、tar.gzファイルは生成されなくなりました。

過去に一部のリリースワークフローの実行に失敗がありましたが、現在のリリースプロセスは正常に機能しています。リリースを行う際は以下のコマンドを使用します：

```
gh workflow run release.yml -f version=v{バージョン番号}
```

リリース後は以下のコマンドでステータスを確認できます：

```
gh run list --workflow=release.yml --limit 1
gh release view v{バージョン番号}
```
